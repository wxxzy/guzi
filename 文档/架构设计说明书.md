# 股票智能分析系统 - 架构设计说明书

## 1. 系统概述

本系统是一个基于AI大模型的股票智能分析平台。它采用现代化的微服务架构，前后端分离，旨在为用户提供实时、智能、个性化的股票分析服务。系统通过集成多源金融数据和多种AI大模型能力，实现复杂的股票筛选、评估和预警功能。

## 2. 架构原则

- **高内聚、低耦合**: 通过微服务划分，确保各服务功能独立、职责单一，易于开发、测试和维护。
- **前后端分离**: 前端专注于用户体验和界面呈现，后端专注于业务逻辑和数据处理，通过API进行通信。
- **可扩展性**: 架构设计应支持未来新功能、新数据源、新AI模型的平滑接入。
- **容错与弹性**: 关键服务（如AI服务、数据服务）应具备降级、熔断和重试机制，保证系统在部分组件故障时仍能提供核心服务。

## 3. 技术选型

| 领域       | 技术/框架         | 备注                                       |
| ---------- | ----------------- | ------------------------------------------ |
| **后端**   | Python, Flask     | 轻量、灵活，生态丰富，适合快速开发API服务。    |
| **前端**   | React.js          | 采用组件化开发模式，拥有强大的社区和生态。 |
| **UI库**   | Ant Design        | 提供高质量、开箱即用的React UI组件。       |
| **数据库** | DuckDB / PostgreSQL | DuckDB用于本地开发，PostgreSQL用于生产环境。 |
| **缓存**   | Redis             | 用于缓存热点数据（如股票行情）和API响应。  |
| **AI服务** | Gemini, 通义, 火山等 | 通过统一接口层进行集成，支持多厂商。       |
| **数据源** | AkShare           | 提供全面、免费的金融数据。                 |
| **异步任务**| Celery            | 用于处理耗时的分析任务，避免阻塞API请求。  |

## 4. 系统架构图

```mermaid
graph TD
    subgraph 用户端
        A[浏览器/移动端]
    end

    subgraph 前端 (React)
        B[表示层]
        C[状态管理]
        D[API客户端]
    end

    subgraph 后端 (Python/Flask)
        E[API网关]
        subgraph 微服务
            F[用户服务]
            G[数据服务]
            H[AI服务]
            I[分析服务]
        end
    end

    subgraph 数据与服务
        J[PostgreSQL数据库]
        K[Redis缓存]
        L[Celery任务队列]
        M[第三方数据源 AkShare]
        N[第三方AI服务]
    end

    A --> B
    B <--> C
    C --> D
    D --> E

    E --> F
    E --> G
    E --> H
    E --> I

    F --> J
    G --> J
    G --> K
    G --> M
    H --> N
    I --> G
    I --> H
    I --> L
    L --> G
```

## 5. 服务划分

- **API网关 (API Gateway)**: 系统的统一入口，负责请求路由、身份认证、速率限制等。前端应用只与网关通信。
- **用户服务 (User Service)**: 负责用户注册、登录、个人信息管理、自选股列表等。
- **数据服务 (Data Service)**: 负责从AkShare等数据源获取、清洗、存储和提供所有金融数据。内置缓存机制。
- **AI服务 (AI Service)**: 统一管理对外部AI大模型的调用。提供自然语言理解、文本生成、情绪分析等标准化接口。
- **分析服务 (Analysis Service)**: 系统的核心业务逻辑层。负责执行五大分析模型（龙头识别、低估值分析等）。对于耗时较长的分析，通过Celery异步执行。

## 6. 前端架构

- **组件化**: 基于React Hooks和函数式组件，构建可复用的UI组件。
- **状态管理**: 使用Zustand或Redux进行全局状态管理，处理如用户信息、全局配置等。
- **数据请求**: 使用`axios`或`fetch` API，封装统一的请求客户端，处理API调用、错误和加载状态。
- **路由**: 使用`react-router-dom`进行页面路由管理。

## 7. 数据存储

- **关系型数据库 (PostgreSQL)**: 存储结构化数据，如用户信息、股票基本信息、财务报表数据、用户自选股等。
- **缓存 (Redis)**: 存储需要快速访问的临时性或热点数据，如：
    - 实时股票行情。
    - API网关的速率限制计数。
    - 已计算的分析结果，在一定时间内可复用。

## 8. 代码版本管理

采用 **Git Flow** 工作流：
- `main`分支: 用于存放生产环境的稳定版本代码，只接受来自`develop`和`hotfix`分支的合并。
- `develop`分支: 开发主分支，集成了所有已完成的功能。新功能开发都从该分支创建`feature`分支。
- `feature/*`分支: 用于开发新功能，完成后合并回`develop`。
- `release/*`分支: 用于准备发布新版本，完成后同时合并到`main`和`develop`。
- `hotfix/*`分支: 用于修复生产环境的紧急Bug，完成后同时合并到`main`和`develop`。
